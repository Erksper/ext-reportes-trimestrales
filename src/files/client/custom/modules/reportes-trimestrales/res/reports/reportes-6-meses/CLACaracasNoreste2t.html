<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis del Mercado Inmobiliario Venezolano</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #F8F5F2; /* Fondo general */
            color: #3D405B; /* Títulos principales y texto principal */
        }
        h1, h2, h3 {
            text-align: center;
            color: #3D405B;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Ajuste para evitar gráficos demasiado anchos */
            height: 320px; /* Altura fija para gráficos */
            max-height: 320px;
            margin-left: auto;
            margin-right: auto;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
        }
        .filter-button {
            /* Using Tailwind classes directly in JS is not standard, so apply styles here */
            padding-left: 1rem;
            padding-right: 1rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
            background-color: #B3B3B3; /* Color para 2023 y elementos secundarios */
            color: white;
            border: none;
            cursor: pointer;
        }
        .filter-button.active {
            background-color: #ADAD86; /* Color para 2025 y estados activos */
        }
        .metric-card {
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: transform 200ms;
            background-color: white;
        }
        .metric-card:hover {
            transform: scale(1.05);
        }
        .metric-value {
            font-size: 1.875rem;
            line-height: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #3D405B;
        }
        .metric-change {
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #ACA68B; /* Color para "Alquiler" y estados activos */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Sección del Encabezado -->
    <header class="mb-8">
        <h1 class="text-4xl font-bold mb-2" contenteditable="true">Análisis del Mercado Inmobiliario</h1>
        <h1 class="text-2xl font-semibold">Primer Semestre 2023-2025</h1>
    </header>

    <!-- Sección de Resumen del Mercado -->
    <section class="mb-12">
        <h2 class="text-3xl font-semibold mb-6">CLA Caracas Noreste</h2>

        <!-- Gráfico 1: Evolución del Volumen de Operaciones -->
        <div class="chart-container">
            <canvas id="volumenOperacionesChart"></canvas>
        </div>
        <!-- Texto de Análisis para Gráfico 1 -->
        <p id="analisisVolumenOperaciones" class="text-center text-lg mt-4 mb-8 max-w-2xl mx-auto"></p>

        <!-- Gráfico 2: Mix de Operaciones -->
        <div class="chart-container">
            <canvas id="mixOperacionesChart"></canvas>
        </div>
        <!-- Texto de Análisis para Gráfico 2 -->
        <p id="analisisMixOperaciones" class="text-center text-lg mt-4 mb-8 max-w-2xl mx-auto"></p>
    </section>

    <!-- Sección del Explorador de Mercado Detallado -->
    <section>
        <h2 class="text-3xl font-semibold mb-6">Explorador de Mercado Detallado</h2>

        <!-- Filtros Interactivos -->
        <div class="flex flex-wrap justify-center gap-4 mb-8">
            <div class="flex gap-2 p-2 bg-white rounded-lg shadow-sm">
                <button id="filterAlquiler" class="filter-button active" data-operation="alquiler">Alquiler</button>
                <button id="filterVenta" class="filter-button" data-operation="venta">Venta</button>
            </div>
            <div class="flex flex-wrap gap-2 p-2 bg-white rounded-lg shadow-sm">
                <button id="filterApartamento" class="filter-button active" data-property="apartamento">Apartamento</button>
                <button id="filterCasa" class="filter-button" data-property="casa">Casa</button>
                <button id="filterLocal" class="filter-button" data-property="local">Local</button>
                <button id="filterOficina" class="filter-button" data-property="oficina">Oficina</button>
            </div>
        </div>

        <!-- Tarjetas de Métricas Clave -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="metric-card">
                <p class="text-lg font-medium">Precio Promedio (USD)</p>
                <p id="metricPrecio" class="metric-value"></p>
                <p id="changePrecio" class="metric-change"></p>
            </div>
            <div class="metric-card">
                <p class="text-lg font-medium">Precio Promedio / m² (USD)</p>
                <p id="metricPrecioM2" class="metric-value"></p>
                <p id="changePrecioM2" class="metric-change"></p>
            </div>
            <div class="metric-card">
                <p class="text-lg font-medium">Promedio (m²)</p>
                <p id="metricTamano" class="metric-value"></p>
                <p id="changeTamano" class="metric-change"></p>
            </div>
        </div>

        <!-- Gráfico 3: Evolución de Métricas Clave -->
        <div class="flex flex-wrap justify-center gap-2 mb-4">
            <button id="metricFilterPrecio" class="filter-button" data-metric="precio">Precio Promedio</button>
            <button id="metricFilterPrecioM2" class="filter-button active" data-metric="precio_m2">Precio Promedio / m²</button>
            <button id="metricFilterTamano" class="filter-button" data-metric="tamano">Promedio m²</button>
        </div>
        <div class="chart-container">
            <canvas id="evolucionMeticasChart"></canvas>
        </div>
        <!-- Texto de Análisis para Gráfico 3 -->
        <p id="analisisEvolucionMeticas" class="text-center text-lg mt-4 mb-8 max-w-2xl mx-auto"></p>

        <!-- Gráfico 4: Distribución de Operaciones por Rango de Precio -->
        <div class="chart-container">
            <canvas id="distribucionRangosChart"></canvas>
        </div>
        <!-- Texto de Análisis para Gráfico 4 -->
        <p id="analisisDistribucionRangos" class="text-center text-lg mt-4 mb-8 max-w-2xl mx-auto"></p>
    </section>

    <script>
        // Datos del Dashboard (Objeto JavaScript data)
        const data = {
            general: {
                lados: {
                    alquiler: [152, 149, 131],
                    venta: [183, 181, 168]
                }
            },
            alquiler: {
                apartamento: {
                    metrics: {
                        precio: [668.55, 706.50, 676.61],
                        precio_m2: [7.86, 7.33, 7.42],
                        tamano: [86.46, 99.27, 92.74]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [0, 0, 31, 28, 11],
                            [1, 3, 32, 24, 13],
                            [0, 2, 34, 20, 8]
                        ]
                    }
                },
                casa: {
                    metrics: {
                        precio: [460.00, 200.00, 2600.00],
                        precio_m2: [8.56, 10.00, 7.43],
                        tamano: [150.00, 20.00, 350.00]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [0, 1, 4, 2, 1],
                            [0, 2, 3, 1, 0],
                            [0, 0, 1, 0, 1]
                        ]
                    }
                },
                local: {
                    metrics: {
                        precio: [545.45, 675.48, 764.21],
                        precio_m2: [11.13, 14.26, 18.09],
                        tamano: [79.90, 85.75, 71.77]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [0, 12, 10, 10, 4],
                            [0, 7, 15, 11, 6],
                            [0, 3, 13, 14, 5]
                        ]
                    }
                },
                oficina: {
                    metrics: {
                        precio: [613.85, 655.85, 630.91],
                        precio_m2: [6.79, 10.47, 10.14],
                        tamano: [92.69, 66.70, 107.44]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [0, 6, 13, 4, 3],
                            [0, 4, 9, 8, 4],
                            [0, 2, 11, 6, 1]
                        ]
                    }
                }
            },
            venta: {
                apartamento: {
                    metrics: {
                        precio: [49568.75, 44076.62, 56664.67],
                        precio_m2: [487.32, 445.99, 626.52],
                        tamano: [94.49, 95.22, 96.52]
                    },
                    ranges: {
                        labels: ['<10k', '10k-25k', '25k-50k', '50k-100k', '>100k'],
                        values: [
                            [0, 40, 60, 29, 11],
                            [0, 41, 60, 32, 9],
                            [0, 32, 48, 41, 7]
                        ]
                    }
                },
                casa: {
                    metrics: {
                        precio: [77750.00, 81800.00, 68000.00],
                        precio_m2: [278.16, 312.23, 225.56],
                        tamano: [243.63, 249.26, 327.62]
                    },
                    ranges: {
                        labels: ['<10k', '10k-25k', '25k-50k', '50k-100k', '>100k'],
                        values: [
                            [0, 7, 2, 7, 4],
                            [1, 2, 2, 6, 2],
                            [0, 4, 5, 8, 4]
                        ]
                    }
                },
                local: {
                    metrics: {
                        precio: [82166.67, 47000.00, 40000.00],
                        precio_m2: [1205.34, 502.18, 644.51],
                        tamano: [145.00, 90.86, 137.75]
                    },
                    ranges: {
                        labels: ['<10k', '10k-25k', '25k-50k', '50k-100k', '>100k'],
                        values: [
                            [0, 2, 1, 2, 2],
                            [0, 2, 4, 2, 2],
                            [0, 0, 1, 1, 0]
                        ]
                    }
                },
                oficina: {
                    metrics: {
                        precio: [49126.33, 80709.00, 119820.00],
                        precio_m2: [944.44, 1256.02, 1569.95],
                        tamano: [53.94, 77.92, 89.05]
                    },
                    ranges: {
                        labels: ['<25k', '25k-50k', '50k-100k', '100k-150k', '>150k'],
                        values: [
                            [2, 0, 2, 0, 0],
                            [2, 2, 1, 0, 2],
                            [0, 3, 2, 0, 4]
                        ]
                    }
                }
            }
        };

        // Variables de estado global
        let currentOperation = 'alquiler';
        let currentProperty = 'apartamento';
        let currentMetric = 'precio_m2';

        // Instancias de Chart.js
        let volumenOperacionesChart;
        let mixOperacionesChart;
        let evolucionMeticasChart;
        let distribucionRangosChart;

        /**
         * Calcula el cambio porcentual entre dos valores.
         * @param {number} current - El valor actual.
         * @param {number} previous - El valor anterior.
         * @returns {string} El texto de cambio porcentual (ej. "▲ 10.5%") o vacío.
         */
        function calculatePercentageChange(current, previous) {
            if (typeof current !== 'number' || typeof previous !== 'number' || isNaN(current) || isNaN(previous) || previous === 0) {
                return '';
            }
            const change = ((current - previous) / previous) * 100;
            const arrow = change >= 0 ? '▲' : '▼';
            return `${arrow} ${Math.abs(change).toFixed(1)}% vs Periodo Enero-Junio '24`;
        }

        /**
         * Formatea un número como moneda USD.
         * @param {number} value - El número a formatear.
         * @returns {string} El número formateado como moneda.
         */
        function formatCurrency(value) {
            if (typeof value !== 'number' || isNaN(value)) {
                return 'N/A';
            }
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(value);
        }

        /**
         * Formatea un número con sufijo de m².
         * @param {number} value - El número a formatear.
         * @returns {string} El número formateado con ' m²'.
         */
        function formatSquareMeters(value) {
            if (typeof value !== 'number' || isNaN(value)) {
                return 'N/A';
            }
            return `${value.toFixed(2)} m²`;
        }

        /**
         * Formatea un número con sufijo de USD/m².
         * @param {number} value - El número a formatear.
         * @returns {string} El número formateado con ' USD/m²'.
         */
        function formatPricePerSquareMeter(value) {
            if (typeof value !== 'number' || isNaN(value)) {
                return 'N/A';
            }
            return `${value.toFixed(2)} USD/m²`;
        }

        /**
         * Renderiza el Gráfico 1: Evolución del Volumen de Operaciones.
         */
        function renderVolumenOperacionesChart() {
            const ctx = document.getElementById('volumenOperacionesChart').getContext('2d');
            const alquilerData = data.general.lados.alquiler;
            const ventaData = data.general.lados.venta;

            if (volumenOperacionesChart) {
                volumenOperacionesChart.destroy();
            }

            volumenOperacionesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Periodo Enero-Junio 2023', 'Periodo Enero-Junio 2024', 'Periodo Enero-Junio 2025'],
                    datasets: [{
                        label: 'Alquiler',
                        data: alquilerData,
                        backgroundColor: '#ACA68B',
                        borderColor: '#ACA68B',
                        borderWidth: 1
                    }, {
                        label: 'Venta',
                        data: ventaData,
                        backgroundColor: '#3D405B',
                        borderColor: '#3D405B',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evolución del Volumen de Operaciones (Lados)',
                            font: { size: 18, family: 'Montserrat' },
                            color: '#3D405B'
                        },
                        legend: {
                            labels: {
                                font: { family: 'Montserrat' },
                                color: '#3D405B'
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Periodo', font: { family: 'Montserrat' }, color: '#3D405B' },
                            ticks: { font: { family: 'Montserrat' }, color: '#3D405B' }
                        },
                        y: {
                            title: { display: true, text: 'Nº de Operaciones', font: { family: 'Montserrat' }, color: '#3D405B' },
                            beginAtZero: true,
                            ticks: { font: { family: 'Montserrat' }, color: '#3D405B' }
                        }
                    }
                }
            });

            // Actualizar texto de análisis
            const total2025 = alquilerData[2] + ventaData[2];
            const total2024 = alquilerData[1] + ventaData[1];
            const changeTotal = calculatePercentageChange(total2025, total2024);
            const changeAlquiler = calculatePercentageChange(alquilerData[2], alquilerData[1]);
            const changeVenta = calculatePercentageChange(ventaData[2], ventaData[1]);

            let analysisText = `El volumen total de operaciones en 2025 fue de ${total2025} lados${changeTotal ? `, lo que representa un ${changeTotal} respecto a 2024.` : '.'}`;
            analysisText += ` Las operaciones de alquiler en 2025 fueron ${alquilerData[2]} lados${changeAlquiler ? ` (${changeAlquiler})` : ''} y las de venta fueron ${ventaData[2]} lados${changeVenta ? ` (${changeVenta})` : ''}.`;
            document.getElementById('analisisVolumenOperaciones').textContent = analysisText;
        }

        /**
         * Renderiza el Gráfico 2: Mix de Operaciones (Periodo Enero-Junio 2025).
         */
        function renderMixOperacionesChart() {
            const ctx = document.getElementById('mixOperacionesChart').getContext('2d');
            const alquiler2025 = data.general.lados.alquiler[2];
            const venta2025 = data.general.lados.venta[2];
            const total2025 = alquiler2025 + venta2025;

            if (mixOperacionesChart) {
                mixOperacionesChart.destroy();
            }

            mixOperacionesChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Alquiler', 'Venta'],
                    datasets: [{
                        data: [alquiler2025, venta2025],
                        backgroundColor: ['#ACA68B', '#3D405B'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Mix de Operaciones (Periodo Enero-Junio 2025)',
                            font: { size: 18, family: 'Montserrat' },
                            color: '#3D405B'
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: 'Montserrat' },
                                color: '#3D405B'
                            }
                        }
                    }
                }
            });

            // Actualizar texto de análisis
            const porcentajeAlquiler = total2025 > 0 ? ((alquiler2025 / total2025) * 100).toFixed(1) : '0';
            const porcentajeVenta = total2025 > 0 ? ((venta2025 / total2025) * 100).toFixed(1) : '0';
            document.getElementById('analisisMixOperaciones').textContent = `En el Periodo Enero-Junio 2025, el ${porcentajeAlquiler}% de las operaciones fueron de alquiler y el ${porcentajeVenta}% fueron de venta. Esto indica que las ventas continúan siendo la mayoría de las transacciones en el mercado.`;
        }

        /**
         * Actualiza las tarjetas de métricas clave.
         */
        function updateMetricCards() {
            const metrics = data[currentOperation][currentProperty].metrics;
            const precio2025 = metrics.precio[2];
            const precio2024 = metrics.precio[1];
            const precioM22025 = metrics.precio_m2[2];
            const precioM22024 = metrics.precio_m2[1];
            const tamano2025 = metrics.tamano[2];
            const tamano2024 = metrics.tamano[1];

            document.getElementById('metricPrecio').textContent = formatCurrency(precio2025);
            document.getElementById('changePrecio').textContent = calculatePercentageChange(precio2025, precio2024);

            document.getElementById('metricPrecioM2').textContent = formatPricePerSquareMeter(precioM22025);
            document.getElementById('changePrecioM2').textContent = calculatePercentageChange(precioM22025, precioM22024);

            document.getElementById('metricTamano').textContent = formatSquareMeters(tamano2025);
            document.getElementById('changeTamano').textContent = calculatePercentageChange(tamano2025, tamano2024);
        }

        /**
         * Renderiza el Gráfico 3: Evolución de Métricas Clave.
         */
        function renderEvolucionMeticasChart() {
            const ctx = document.getElementById('evolucionMeticasChart').getContext('2d');
            const metrics = data[currentOperation][currentProperty].metrics[currentMetric];
            const metricLabels = {
                precio: 'Precio Promedio (USD)',
                precio_m2: 'Precio Promedio / m² (USD)',
                tamano: 'Promedio de m² Transados'
            };
            const metricFormatters = {
                precio: formatCurrency,
                precio_m2: formatPricePerSquareMeter,
                tamano: formatSquareMeters
            };

            if (evolucionMeticasChart) {
                evolucionMeticasChart.destroy();
            }

            evolucionMeticasChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2023', '2024', '2025'],
                    datasets: [{
                        label: metricLabels[currentMetric],
                        data: metrics,
                        backgroundColor: ['#B3B3B3', '#A38600', '#ADAD86'],
                        borderColor: ['#B3B3B3', '#A38600', '#ADAD86'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Evolución de ${metricLabels[currentMetric]} (${currentOperation} - ${currentProperty.charAt(0).toUpperCase() + currentProperty.slice(1)})`,
                            font: { size: 18, family: 'Montserrat' },
                            color: '#3D405B'
                        },
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Año', font: { family: 'Montserrat' }, color: '#3D405B' },
                            ticks: { font: { family: 'Montserrat' }, color: '#3D405B' }
                        },
                        y: {
                            title: { display: true, text: metricLabels[currentMetric], font: { family: 'Montserrat' }, color: '#3D405B' },
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => metricFormatters[currentMetric](value) || value,
                                font: { family: 'Montserrat' },
                                color: '#3D405B'
                            }
                        }
                    }
                }
            });
            
            // Actualizar texto de análisis
            const change = calculatePercentageChange(metrics[2], metrics[1]);
            let analysisText = `Para ${currentProperty} en ${currentOperation}, el ${metricLabels[currentMetric].toLowerCase()} en 2025 fue de ${metricFormatters[currentMetric](metrics[2])}`;
            analysisText += change ? `, lo que representa un ${change}.` : '.';
            document.getElementById('analisisEvolucionMeticas').textContent = analysisText;
        }

        /**
         * Renderiza el Gráfico 4: Distribución de Operaciones por Rango de Precio.
         */
        function renderDistribucionRangosChart() {
            const ctx = document.getElementById('distribucionRangosChart').getContext('2d');
            const rangesData = data[currentOperation][currentProperty].ranges;

            if (distribucionRangosChart) {
                distribucionRangosChart.destroy();
            }

            distribucionRangosChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: rangesData.labels,
                    datasets: [{
                        label: '2023',
                        data: rangesData.values[0],
                        backgroundColor: '#B3B3B3',
                        borderWidth: 1
                    }, {
                        label: '2024',
                        data: rangesData.values[1],
                        backgroundColor: '#A38600',
                        borderWidth: 1
                    }, {
                        label: '2025',
                        data: rangesData.values[2],
                        backgroundColor: '#ADAD86',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribución por Rango de Precio (${currentOperation} - ${currentProperty.charAt(0).toUpperCase() + currentProperty.slice(1)})`,
                            font: { size: 18, family: 'Montserrat' },
                            color: '#3D405B'
                        },
                        legend: {
                            labels: { font: { family: 'Montserrat' }, color: '#3D405B' }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Rango de Precio (USD)', font: { family: 'Montserrat' }, color: '#3D405B' },
                            ticks: { font: { family: 'Montserrat' }, color: '#3D405B' }
                        },
                        y: {
                            title: { display: true, text: 'Nº de Lados', font: { family: 'Montserrat' }, color: '#3D405B' },
                            beginAtZero: true,
                            ticks: { font: { family: 'Montserrat' }, color: '#3D405B' }
                        }
                    }
                }
            });

            // Actualizar texto de análisis
            let maxLados2025 = 0;
            let maxRange2025 = '';
            rangesData.values[2].forEach((value, i) => {
                if (value > maxLados2025) {
                    maxLados2025 = value;
                    maxRange2025 = rangesData.labels[i];
                }
            });
            const indexMaxRange = rangesData.labels.indexOf(maxRange2025);
            const maxLados2024 = indexMaxRange !== -1 ? rangesData.values[1][indexMaxRange] : 0;
            const change = calculatePercentageChange(maxLados2025, maxLados2024);
            let analysisText = `Para ${currentProperty} en ${currentOperation}, el rango de precio más activo en 2025 fue "${maxRange2025}" con ${maxLados2025} lados.`;
            analysisText += change ? ` Esto representa un ${change} para este rango en comparación con 2024.` : '';
            document.getElementById('analisisDistribucionRangos').textContent = analysisText;
        }

        /**
         * Actualiza todos los gráficos y métricas del explorador detallado.
         */
        function updateDetailedExplorer() {
            updateMetricCards();
            renderEvolucionMeticasChart();
            renderDistribucionRangosChart();
        }

        // --- Event Listeners ---
        function setupEventListeners() {
            document.querySelectorAll('[data-operation]').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('[data-operation]').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    currentOperation = button.dataset.operation;
                    updateDetailedExplorer();
                });
            });

            document.querySelectorAll('[data-property]').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('[data-property]').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    currentProperty = button.dataset.property;
                    updateDetailedExplorer();
                });
            });

            document.querySelectorAll('[data-metric]').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('[data-metric]').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    currentMetric = button.dataset.metric;
                    renderEvolucionMeticasChart();
                });
            });
        }
        
        // Inicializar el dashboard al cargar el DOM
        document.addEventListener('DOMContentLoaded', () => {
            renderVolumenOperacionesChart();
            renderMixOperacionesChart();
            updateDetailedExplorer();
            setupEventListeners();
        });
    </script>
</body>
</html>
