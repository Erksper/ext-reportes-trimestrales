<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis del Mercado Inmobiliario</title>
    <!-- Google Fonts: Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #F8F5F2; /* Fondo general: Century Neutral Warm */
            color: #3D405B; /* Títulos principales y texto principal */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header-title {
            color: #3D405B;
            font-weight: 700;
        }
        .section-title {
            color: #3D405B;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 20px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        .filter-button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            border: 1px solid #B3B3B3;
            color: #3D405B;
        }
        .filter-button:hover {
            background-color: #e0e0e0;
        }
        .filter-button.active {
            background-color: #ADAD86; /* Color para 2025 y estados activos */
            color: #ffffff;
            border-color: #ADAD86;
        }
        .chart-container-wrapper {
            width: 100%;
            height: 320px; /* Altura fija para gráficos */
            max-height: 320px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .chart-container-wrapper canvas {
            width: 100% !important;
            height: 100% !important;
        }
        @media (min-width: 768px) {
            .chart-container-wrapper {
                height: 380px;
                max-height: 380px;
            }
        }
        @media (min-width: 1024px) {
            .chart-container-wrapper {
                height: 420px;
                max-height: 420px;
            }
        }
    </style>
</head>
<body class="antialiased">
    <div class="container py-8">
        <!-- Sección del Encabezado -->
        <header class="text-center mb-10">
            <h1 class="text-4xl header-title mb-2" contenteditable="true">Análisis del Mercado Inmobiliario</h1>
            <h2 class="text-xl text-gray-600">Primer Semestre 2023-2025</h2>
        </header>

        <!-- Sección de Resumen del Mercado -->
        <section class="mb-12">
            <h3 class="text-2xl section-title text-center mb-6">CLA Centro Occidente</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card">
                    <!-- Gráfico 1: Evolución del Volumen de Operaciones -->
                    <h4 class="text-xl font-semibold text-center mb-4">Evolución del Volumen de Operaciones (Lados)</h4>
                    <div class="chart-container-wrapper">
                        <canvas id="volumeChart"></canvas>
                    </div>
                    <!-- Texto de Análisis para Gráfico 1 -->
                    <p id="volumeAnalysis" class="text-sm text-gray-700 mt-4 text-center"></p>
                </div>

                <div class="card">
                    <!-- Gráfico 2: Mix de Operaciones -->
                    <h4 class="text-xl font-semibold text-center mb-4">Mix de Operaciones (Primer Semestre 2025)</h4>
                    <div class="chart-container-wrapper">
                        <canvas id="mixChart"></canvas>
                    </div>
                    <!-- Texto de Análisis para Gráfico 2 -->
                    <p id="mixAnalysis" class="text-sm text-gray-700 mt-4 text-center"></p>
                </div>
            </div>
        </section>

        <!-- Sección del Explorador de Mercado Detallado -->
        <section>
            <h3 class="text-2xl section-title text-center mb-6">Explorador de Mercado Detallado</h3>

            <!-- Filtros Interactivos -->
            <div class="flex flex-wrap justify-center gap-4 mb-8">
                <div class="flex gap-2 p-2 bg-gray-100 rounded-lg shadow-sm">
                    <button id="filterAlquiler" class="filter-button active" data-operation="alquiler">Alquiler</button>
                    <button id="filterVenta" class="filter-button" data-operation="venta">Venta</button>
                </div>
                <div class="flex gap-2 p-2 bg-gray-100 rounded-lg shadow-sm">
                    <button id="filterApartamento" class="filter-button active" data-property="apartamento">Apartamento</button>
                    <button id="filterCasa" class="filter-button" data-property="casa">Casa</button>
                    <button id="filterLocal" class="filter-button" data-property="local">Local</button>
                    <button id="filterOficina" class="filter-button" data-property="oficina">Oficina</button>
                </div>
            </div>

            <!-- Tarjetas de Métricas Clave -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="card text-center">
                    <h5 class="text-lg font-medium mb-2">Precio Promedio (USD)</h5>
                    <p id="avgPrice" class="text-3xl font-bold text-gray-800">$0</p>
                    <p id="avgPriceChange" class="text-sm text-gray-600 mt-1"></p>
                </div>
                <div class="card text-center">
                    <h5 class="text-lg font-medium mb-2">Precio Promedio / m² (USD)</h5>
                    <p id="avgPriceM2" class="text-3xl font-bold text-gray-800">$0</p>
                    <p id="avgPriceM2Change" class="text-sm text-gray-600 mt-1"></p>
                </div>
                <div class="card text-center">
                    <h5 class="text-lg font-medium mb-2">Promedio (m²)</h5>
                    <p id="avgSize" class="text-3xl font-bold text-gray-800">0 m²</p>
                    <p id="avgSizeChange" class="text-sm text-gray-600 mt-1"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card">
                    <!-- Gráfico 3: Evolución de Métricas Clave -->
                    <h4 class="text-xl font-semibold text-center mb-4">Evolución de Métricas Clave (Primer Semestre 2023-2025)</h4>
                    <div class="flex justify-center gap-2 mb-4 p-2 bg-gray-100 rounded-lg shadow-sm">
                        <button id="metricPrice" class="filter-button" data-metric="precio">Precio Promedio</button>
                        <button id="metricPriceM2" class="filter-button active" data-metric="precio_m2">Precio Promedio / m²</button>
                        <button id="metricSize" class="filter-button" data-metric="tamano">Promedio m²</button>
                    </div>
                    <div class="chart-container-wrapper">
                        <canvas id="metricEvolutionChart"></canvas>
                    </div>
                    <!-- Texto de Análisis para Gráfico 3 -->
                    <p id="metricEvolutionAnalysis" class="text-sm text-gray-700 mt-4 text-center"></p>
                </div>

                <div class="card">
                    <!-- Gráfico 4: Distribución de Operaciones por Rango de Precio -->
                    <h4 class="text-xl font-semibold text-center mb-4">Distribución de Operaciones por Rango de Precio (Lados)</h4>
                    <div class="chart-container-wrapper">
                        <canvas id="priceRangeChart"></canvas>
                    </div>
                    <!-- Texto de Análisis para Gráfico 4 -->
                    <p id="priceRangeAnalysis" class="text-sm text-gray-700 mt-4 text-center"></p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Datos del Dashboard
        const data = {
            general: {
                lados: {
                    alquiler: [72, 84, 106],
                    venta: [73, 129, 172]
                }
            },
            alquiler: {
                apartamento: {
                    metrics: {
                        precio: [370.04, 430.31, 369.84],
                        precio_m2: [3.99, 4.65, 4.37],
                        tamano: [100.40, 91.78, 86.54]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [0, 13, 20, 7, 0], // 2023 (<100, 100-250, 250-500, 500-1k, >1k)
                            [0, 8, 30, 4, 1], // 2024
                            [0, 11, 39, 2, 0] // 2025
                        ]
                    }
                },
                casa: {
                    metrics: {
                        precio: [300.00, 392.50, 295.00],
                        precio_m2: [4.70, 2.50, 1.87],
                        tamano: [63.80, 156.98, 157.56]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [2, 2, 4, 1, 0], // 2023
                            [0, 4, 6, 1, 0], // 2024
                            [2, 4, 11, 0, 0] // 2025
                        ]
                    }
                },
                local: {
                    metrics: {
                        precio: [581.88, 613.33, 432.86],
                        precio_m2: [7.49, 7.39, 6.14],
                        tamano: [71.93, 77.25, 70.57]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [0, 2, 9, 4, 2], // 2023
                            [0, 2, 4, 4, 1], // 2024
                            [2, 4, 9, 0, 1] // 2025
                        ]
                    }
                },
                oficina: {
                    metrics: {
                        precio: [320.00, 225.00, 90.00],
                        precio_m2: [7.57, 2.95, 3.32],
                        tamano: [41.00, 76.33, 27.00]
                    },
                    ranges: {
                        labels: ['< 100', '100-250', '250-500', '500-1k', '> 1k'],
                        values: [
                            [0, 1, 1, 0, 0], // 2023
                            [0, 5, 0, 0, 0], // 2024
                            [4, 0, 0, 0, 0] // 2025
                        ]
                    }
                }
            },
            venta: {
                apartamento: {
                    metrics: {
                        precio: [23460.92, 25240.63, 26428.57],
                        precio_m2: [214.10, 261.98, 318.83],
                        tamano: [98.71, 96.74, 83.62]
                    },
                    ranges: {
                        labels: ['<10k', '10k-25k', '25k-50k', '50k-100k', '>100k'],
                        values: [
                            [12, 6, 3, 4, 0], // 2023
                            [7, 30, 22, 2, 0], // 2024
                            [2, 29, 13, 9, 0] // 2025
                        ]
                    }
                },
                casa: {
                    metrics: {
                        precio: [43949.75, 44000.00, 42770.97],
                        precio_m2: [218.45, 224.43, 180.67],
                        tamano: [168.00, 217.56, 233.13]
                    },
                    ranges: {
                        labels: ['<10k', '10k-25k', '25k-50k', '50k-100k', '>100k'],
                        values: [
                            [5, 10, 2, 3, 1], // 2023
                            [3, 9, 16, 2, 3], // 2024
                            [4, 33, 17, 6, 2] // 2025
                        ]
                    }
                },
                local: {
                    metrics: {
                        precio: [15000.00, 4500.00, 17333.33],
                        precio_m2: [1071.43, 243.24, 316.15],
                        tamano: [14.00, 18.50, 71.20]
                    },
                    ranges: {
                        labels: ['<10k', '10k-25k', '25k-50k', '50k-100k', '>100k'],
                        values: [
                            [0, 2, 0, 1, 0], // 2023
                            [2, 0, 0, 0, 0], // 2024
                            [0, 7, 0, 0, 0] // 2025
                        ]
                    }
                },
                oficina: {
                    metrics: {
                        precio: [0, 20000.00, 17500.00],
                        precio_m2: [0, 555.56, 210.84],
                        tamano: [0, 36.00, 83.00]
                    },
                    ranges: {
                        labels: ['<25k', '25k-50k', '50k-100k', '100k-150k', '>150k'],
                        values: [
                            [0, 0, 0, 0, 0], // 2023
                            [1, 0, 0, 0, 0], // 2024
                            [2, 0, 0, 0, 0] // 2025
                        ]
                    }
                }
            }
        };

        // Variables de estado del dashboard
        let selectedOperation = 'alquiler';
        let selectedProperty = 'apartamento';
        let selectedMetric = 'precio_m2';

        // Instancias de Chart.js
        let volumeChartInstance;
        let mixChartInstance;
        let metricEvolutionChartInstance;
        let priceRangeChartInstance;

        // Función para calcular el cambio porcentual
        function calculatePercentageChange(current, previous) {
            if (previous === null || previous === undefined || isNaN(previous) || previous === 0) {
                if (current === null || current === undefined || isNaN(current) || current === 0) {
                    return { value: current, text: '' };
                }
                return { value: current, text: '' };
            }

            if (current === null || current === undefined || isNaN(current)) {
                return { value: current, text: '' };
            }

            const change = ((current - previous) / previous) * 100;
            const arrow = change >= 0 ? '▲' : '▼';
            const formattedChange = Math.abs(change).toFixed(1);
            return { value: current, text: `${arrow} ${formattedChange}% vs Periodo Enero-Junio '24` };
        }

        // Función para inicializar y actualizar el Gráfico 1: Evolución del Volumen de Operaciones
        function updateVolumeChart() {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            const alquilerData = data.general.lados.alquiler;
            const ventaData = data.general.lados.venta;

            if (volumeChartInstance) {
                volumeChartInstance.destroy();
            }

            volumeChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Periodo Enero-Junio 2023', 'Periodo Enero-Junio 2024', 'Periodo Enero-Junio 2025'],
                    datasets: [
                        {
                            label: 'Alquiler',
                            data: alquilerData,
                            backgroundColor: '#ACA68B',
                            borderColor: '#ACA68B',
                            borderWidth: 1,
                            borderRadius: 5
                        },
                        {
                            label: 'Venta',
                            data: ventaData,
                            backgroundColor: '#3D405B',
                            borderColor: '#3D405B',
                            borderWidth: 1,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#3D405B'
                            }
                        },
                        title: {
                            display: false,
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Período',
                                color: '#3D405B'
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#3D405B'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Nº de Operaciones',
                                color: '#3D405B'
                            },
                            beginAtZero: true,
                            ticks: {
                                color: '#3D405B'
                            }
                        }
                    }
                }
            });

            // Actualizar texto de análisis
            const currentAlquiler = alquilerData[2]; // 2025
            const previousAlquiler = alquilerData[1]; // 2024
            const currentVenta = ventaData[2]; // 2025
            const previousVenta = ventaData[1]; // 2024
            const total2025 = currentAlquiler + currentVenta;
            const total2024 = previousAlquiler + previousVenta;
            const totalChange = calculatePercentageChange(total2025, total2024);
            const alquilerChange = calculatePercentageChange(currentAlquiler, previousAlquiler);
            const ventaChange = calculatePercentageChange(currentVenta, previousVenta);

            let analysisText = `El volumen total de operaciones en 2025 fue de ${total2025} lados.`;
            if (totalChange.text) {
                analysisText += ` Esto representa un ${totalChange.text.replace('vs Periodo Enero-Junio \'24', 'respecto a 2024')}.`;
            } else {
                analysisText += ` No se pudo calcular el porcentaje de cambio total respecto a 2024.`;
            }
            analysisText += ` Las operaciones de alquiler alcanzaron ${currentAlquiler} lados`;
            if (alquilerChange.text) {
                analysisText += ` (${alquilerChange.text.replace('vs Periodo Enero-Junio \'24', 'respecto a 2024')})`;
            }
            analysisText += ` y las de venta ${currentVenta} lados`;
            if (ventaChange.text) {
                analysisText += ` (${ventaChange.text.replace('vs Periodo Enero-Junio \'24', 'respecto a 2024')})`;
            }
            analysisText += `.`;
            document.getElementById('volumeAnalysis').innerText = analysisText;
        }

        // Función para inicializar y actualizar el Gráfico 2: Mix de Operaciones
        function updateMixChart() {
            const ctx = document.getElementById('mixChart').getContext('2d');
            const alquiler2025 = data.general.lados.alquiler[2];
            const venta2025 = data.general.lados.venta[2];
            const total2025 = alquiler2025 + venta2025;

            if (mixChartInstance) {
                mixChartInstance.destroy();
            }

            mixChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Alquiler', 'Venta'],
                    datasets: [{
                        data: [alquiler2025, venta2025],
                        backgroundColor: ['#ACA68B', '#3D405B'],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#3D405B'
                            }
                        },
                        title: {
                            display: false,
                        }
                    }
                }
            });

            // Actualizar texto de análisis
            const percentAlquiler = ((alquiler2025 / total2025) * 100).toFixed(1);
            const percentVenta = ((venta2025 / total2025) * 100).toFixed(1);
            document.getElementById('mixAnalysis').innerText = `En el Periodo Enero-Junio 2025, el ${percentVenta}% de las operaciones fueron ventas y el ${percentAlquiler}% fueron alquileres, indicando una mayor actividad en el mercado de compra-venta.`;
        }

        // Función para actualizar las tarjetas de métricas clave
        function updateMetricCards() {
            const currentData = data[selectedOperation][selectedProperty].metrics;
            const currentPrice = currentData.precio[2];
            const previousPrice = currentData.precio[1];
            const priceChange = calculatePercentageChange(currentPrice, previousPrice);
            document.getElementById('avgPrice').innerText = `$${priceChange.value ? priceChange.value.toFixed(2) : 'N/D'}`;
            document.getElementById('avgPriceChange').innerText = priceChange.text;
            document.getElementById('avgPriceChange').className = `text-sm mt-1 ${priceChange.text.includes('▲') ? 'text-green-600' : (priceChange.text.includes('▼') ? 'text-red-600' : 'text-gray-600')}`;

            const currentPriceM2 = currentData.precio_m2[2];
            const previousPriceM2 = currentData.precio_m2[1];
            const priceM2Change = calculatePercentageChange(currentPriceM2, previousPriceM2);
            document.getElementById('avgPriceM2').innerText = `$${priceM2Change.value ? priceM2Change.value.toFixed(2) : 'N/D'}`;
            document.getElementById('avgPriceM2Change').innerText = priceM2Change.text;
            document.getElementById('avgPriceM2Change').className = `text-sm mt-1 ${priceM2Change.text.includes('▲') ? 'text-green-600' : (priceM2Change.text.includes('▼') ? 'text-red-600' : 'text-gray-600')}`;

            const currentSize = currentData.tamano[2];
            const previousSize = currentData.tamano[1];
            const sizeChange = calculatePercentageChange(currentSize, previousSize);
            document.getElementById('avgSize').innerText = `${sizeChange.value ? sizeChange.value.toFixed(0) : 'N/D'} m²`;
            document.getElementById('avgSizeChange').innerText = sizeChange.text;
            document.getElementById('avgSizeChange').className = `text-sm mt-1 ${sizeChange.text.includes('▲') ? 'text-green-600' : (sizeChange.text.includes('▼') ? 'text-red-600' : 'text-gray-600')}`;
        }

        // Función para inicializar y actualizar el Gráfico 3: Evolución de Métricas Clave
        function updateMetricEvolutionChart() {
            const ctx = document.getElementById('metricEvolutionChart').getContext('2d');
            const metricData = data[selectedOperation][selectedProperty].metrics[selectedMetric];

            if (metricEvolutionChartInstance) {
                metricEvolutionChartInstance.destroy();
            }

            metricEvolutionChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2023', '2024', '2025'],
                    datasets: [
                        {
                            label: selectedMetric === 'precio' ? 'Precio Promedio' : (selectedMetric === 'precio_m2' ? 'Precio Promedio / m²' : 'Promedio m²'),
                            data: metricData,
                            backgroundColor: ['#B3B3B3', '#A38600', '#ADAD86'],
                            borderColor: ['#B3B3B3', '#A38600', '#ADAD86'],
                            borderWidth: 1,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: false,
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#3D405B'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#3D405B'
                            }
                        }
                    }
                }
            });

            // Actualizar texto de análisis
            const currentVal = metricData[2]; // 2025
            const previousVal = metricData[1]; // 2024
            const metricChange = calculatePercentageChange(currentVal, previousVal);
            let metricName = '';
            if (selectedMetric === 'precio') metricName = 'el precio promedio';
            else if (selectedMetric === 'precio_m2') metricName = 'el precio promedio por m²';
            else if (selectedMetric === 'tamano') metricName = 'el tamaño promedio';

            let analysisText = `Para ${selectedProperty} en ${selectedOperation}, ${metricName} en 2025 es de ${currentVal ? (selectedMetric === 'tamano' ? currentVal.toFixed(0) + ' m²' : '$' + currentVal.toFixed(2)) : 'N/D'}.`;
            if (metricChange.text) {
                analysisText += ` Esto representa un ${metricChange.text.replace('vs Periodo Enero-Junio \'24', 'respecto a 2024')}.`;
            } else {
                analysisText += ` No se pudo calcular el porcentaje de cambio respecto a 2024.`;
            }
            document.getElementById('metricEvolutionAnalysis').innerText = analysisText;
        }

        // Función para inicializar y actualizar el Gráfico 4: Distribución de Operaciones por Rango de Precio
        function updatePriceRangeChart() {
            const ctx = document.getElementById('priceRangeChart').getContext('2d');
            const rangeData = data[selectedOperation][selectedProperty].ranges;
            const rangeLabels = rangeData.labels;
            const rangeValues = rangeData.values;

            if (priceRangeChartInstance) {
                priceRangeChartInstance.destroy();
            }

            priceRangeChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: rangeLabels,
                    datasets: [
                        {
                            label: '2023',
                            data: rangeValues[0],
                            backgroundColor: '#B3B3B3',
                            borderColor: '#B3B3B3',
                            borderWidth: 1,
                            borderRadius: 5
                        },
                        {
                            label: '2024',
                            data: rangeValues[1],
                            backgroundColor: '#A38600',
                            borderColor: '#A38600',
                            borderWidth: 1,
                            borderRadius: 5
                        },
                        {
                            label: '2025',
                            data: rangeValues[2],
                            backgroundColor: '#ADAD86',
                            borderColor: '#ADAD86',
                            borderWidth: 1,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#3D405B'
                            }
                        },
                        title: {
                            display: false,
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Rango de Precio (USD)',
                                color: '#3D405B'
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#3D405B'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Nº de Lados',
                                color: '#3D405B'
                            },
                            beginAtZero: true,
                            ticks: {
                                color: '#3D405B'
                            }
                        }
                    }
                }
            });

            // Actualizar texto de análisis
            const currentRanges = rangeValues[2]; // 2025
            const previousRanges = rangeValues[1]; // 2024
            let maxLados2025 = 0;
            let mostActiveRange2025 = 'N/D';
            for (let i = 0; i < currentRanges.length; i++) {
                if (currentRanges[i] > maxLados2025) {
                    maxLados2025 = currentRanges[i];
                    mostActiveRange2025 = rangeLabels[i];
                }
            }

            let analysisText = `Para ${selectedProperty} en ${selectedOperation}, el rango de precio más activo en 2025 fue ${mostActiveRange2025} con ${maxLados2025} lados.`;
            const indexOfMostActiveRange2025 = rangeLabels.indexOf(mostActiveRange2025);
            if (indexOfMostActiveRange2025 !== -1 && previousRanges[indexOfMostActiveRange2025] !== undefined) {
                const previousValForMostActiveRange = previousRanges[indexOfMostActiveRange2025];
                const rangeChange = calculatePercentageChange(maxLados2025, previousValForMostActiveRange);
                if (rangeChange.text) {
                    analysisText += ` Esto representa un ${rangeChange.text.replace('vs Periodo Enero-Junio \'24', 'respecto a 2024')}.`;
                } else {
                    analysisText += ` No se pudo calcular el porcentaje de cambio para este rango respecto a 2024.`;
                }
            } else {
                analysisText += ` No se pudo calcular el porcentaje de cambio para este rango respecto a 2024.`;
            }
            document.getElementById('priceRangeAnalysis').innerText = analysisText;
        }

        // Función principal para renderizar el dashboard
        function renderDashboard() {
            updateVolumeChart();
            updateMixChart();
            updateMetricCards();
            updateMetricEvolutionChart();
            updatePriceRangeChart();
        }

        // Event Listeners para filtros de operación
        document.querySelectorAll('[data-operation]').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('[data-operation]').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                selectedOperation = button.dataset.operation;
                renderDashboard();
            });
        });

        // Event Listeners para filtros de propiedad
        document.querySelectorAll('[data-property]').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('[data-property]').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                selectedProperty = button.dataset.property;
                renderDashboard();
            });
        });

        // Event Listeners para filtros de métrica (Gráfico 3)
        document.querySelectorAll('[data-metric]').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('[data-metric]').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                selectedMetric = button.dataset.metric;
                updateMetricEvolutionChart();
            });
        });

        // Inicializar el dashboard al cargar la página
        document.addEventListener('DOMContentLoaded', renderDashboard);
    </script>
</body>
</html>
